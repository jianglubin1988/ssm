!function($){"use strict";function xLinkSelect2(t,a){return this.$={},this.options={},this.data=[],this.init(t,a)}xLinkSelect2.prototype={$:[],options:{},_animateEvent:"webkitAnimationEnd oAnimationEnd MSAnimationEnd animationend",init:function(t,a){return this._setOptions(t,a),this._setElement(t),this._setProperty(),this._setEvent(),this},_defaults:{width:450,levelTitles:[],cache:!0,data:[],indexAllText:"全部",levelDefaultText:"请选择",btnSureText:"确定",btnCancleText:"取消",offset:5,ajaxUrl:null,ajaxType:"post",value:"",returnJoinChar:",",showIndexBar:!0,showBtn:!0,className:"",showClassName:"xLinkSelect2-in",hideClassName:"xLinkSelect2-out",onSelect:function(){},onReturn:function(){},onAjaxBefore:function(t){return t},onAjaxAfter:function(t){return t},onShow:function(){},onShowEnd:function(){},onHide:function(){},onHideEnd:function(){},onDestroy:function(){}},_setOptions:function($fn,options){var attrOpts=$fn.attr("role-opts");attrOpts&&(attrOpts=eval("("+attrOpts+")"),attrOpts.xLinkSelect2&&(attrOpts=attrOpts.xLinkSelect2)),this.options=attrOpts?$.extend({},this._defaults,attrOpts):this._defaults,this.options=$.extend({},this.options,options)},_setElement:function(t){this.$.fn=t,this.$.node=$('<div class="xLinkSelect2"><div class="xLinkSelect2-header"><ul></ul></div><div class="xLinkSelect2-content"><ul></ul><div class="xLinkSelect2-loading"></div></div></div>'),this.$.header=this.$.node.find(".xLinkSelect2-header>ul"),this.$.content=this.$.node.find(".xLinkSelect2-content>ul"),this.$.loading=this.$.node.find(".xLinkSelect2-loading"),this.options.showIndexBar&&(this.$.indexBar=$('<ol><li data-char="" ><a href="javascript:;">ALL</a></li><li data-char="A"><a href="javascript:;">A</a></li><li data-char="B"><a href="javascript:;">B</a></li><li data-char="C"><a href="javascript:;">C</a></li><li data-char="D"><a href="javascript:;">D</a></li><li data-char="E"><a href="javascript:;">E</a></li><li data-char="F"><a href="javascript:;">F</a></li><li data-char="G"><a href="javascript:;">G</a></li><li data-char="H"><a href="javascript:;">H</a></li><li data-char="I"><a href="javascript:;">I</a></li><li data-char="J"><a href="javascript:;">J</a></li><li data-char="K"><a href="javascript:;">K</a></li><li data-char="L"><a href="javascript:;">L</a></li><li data-char="M"><a href="javascript:;">M</a></li><li data-char="N"><a href="javascript:;">N</a></li><li data-char="O"><a href="javascript:;">O</a></li><li data-char="P"><a href="javascript:;">P</a></li><li data-char="Q"><a href="javascript:;">Q</a></li><li data-char="R"><a href="javascript:;">R</a></li><li data-char="S"><a href="javascript:;">S</a></li><li data-char="T"><a href="javascript:;">T</a></li><li data-char="U"><a href="javascript:;">U</a></li><li data-char="V"><a href="javascript:;">V</a></li><li data-char="W"><a href="javascript:;">W</a></li><li data-char="X"><a href="javascript:;">X</a></li><li data-char="Y"><a href="javascript:;">Y</a></li><li data-char="Z"><a href="javascript:;">Z</a></li></ol>'),this.$.content.before(this.$.indexBar)),this.options.showBtn&&(this.$.node.append('<div class="xLinkSelect2-footer"><button type="button" class="xBtn xBtn-primary btn-sure"></button><button type="button" class="xBtn btn-cancle"></button></div>'),this.$.btnSure=this.$.node.find(".btn-sure"),this.$.btnCancle=this.$.node.find(".btn-cancle")),this.$.fn.after(this.$.node)},_setProperty:function(){var t=this.options;this.$.indexBar&&this.$.indexBar.find("li:first a").text(t.indexAllText),t.data.length&&(this.data=t.data,t.cache=!0),this.$.btnSure&&this.$.btnSure.text(t.btnSureText),this.$.btnCancle&&this.$.btnCancle.text(t.btnCancleText),t.className&&this.$.node.addClass(t.className),""==t.value&&(t.value=this.$.fn.val())},_setEvent:function(){var t=this;this.$.fn.on("focus",function(){t.setValue($(this).val()),t.show()}),$(document).on("click",function(){t.hide()}),this.$.fn.on("click",function(){return!1}),this.$.node.on("click",function(){return!1}),this.$.node.delegate(".xLinkSelect2-header>ul>li","click",function(){var a=$(this),i=a.data("data"),e=a.data("itemData");return a.addClass("xActive").siblings("li").removeClass("xActive"),t.options.showIndexBar&&t.$.indexBar.find("li").eq(0).addClass("xActive").siblings().removeClass("xActive"),t._viewData(i,e.id,""),!1}),this.$.indexBar&&this.$.indexBar.find("li").on("click",function(){var a=$(this),i=t.$.header.find("li.xActive"),e=i.data("data"),n=i.data("itemData");return a.addClass("xActive").siblings("li").removeClass("xActive"),t._viewData(e,n.id,a.data("char")),!1}),this.$.node.delegate(".xLinkSelect2-content>ul>li","click",function(){var a=$(this),i=t.$.header.find("li.xActive"),e=a.data("itemData");a.addClass("xActive").siblings("li").removeClass("xActive"),i.data("itemData",e).find("a").text(e.title),i.nextAll().remove(),t._createTab(e.id,function(a){if(!a.length&&!t.options.showBtn){var i=t.getSelectData(),e=t.options.onReturn.apply(t,[i]);t.$.fn.val("string"==typeof e?e:i.title.join(t.options.returnJoinChar)),t.hide()}});t.options.onSelect.apply(t,[t.getSelectData()]);return!1}),this.$.btnSure&&this.$.btnSure.on("click",function(){}),this.$.btnCancle&&this.$.btnCancle.on("click",function(){t.hide()})},_getData:function(t,a){var i=this.options,e=this;if(i.cache&&this.data.length){var n=!1,s=[];if(this.data.forEach(function(a){a.pid==t&&(s.push(a),n=!0)}),n)return a&&a(s)}if(!i.ajaxUrl)return a&&a([]);var l=i.onAjaxBefore({pid:t});e._loading(!0),$.ajax({url:i.ajaxUrl,type:i.ajaxType,data:l,dataType:"json",success:function(t){e._loading(!1);var t=i.onAjaxAfter(t);i.cache&&t.forEach(function(t){var a=!1;e.data.forEach(function(i){return t.id===i.id?(a=!0,!0):void 0}),a||e.data.push(t)}),a&&a(t)},error:function(t,a,i){e._loading(!1),console.debug(i)}})},_viewData:function(t,a,i){var e=this;e.$.content.empty(),t.forEach(function(t){var n="undefined"!=typeof xPinYin?xPinYin.getCamelChars(t.title).substring(0,1):"";if(""==i||i==n){var s=$('<li data-char="'+n+'"><a href="javascript:;">'+t.title+"</a></li>");a==t.id&&s.addClass("xActive"),s.data("itemData",t),e.$.content.append(s)}})},_loading:function(t){t?this.$.loading.show():this.$.loading.hide()},_createTab:function(t,a){var i=this,e=this.options;this._getData(t,function(n){if(n.length){var s=e.levelDefaultText;if(t){var l=i.$.header.find("li:last");l.index()+1<i.options.levelTitles.length&&(s=i.options.levelTitles[l.index()+1])}else var s=e.levelTitles.length?e.levelTitles[0]:e.levelDefaultText;var o=$('<li data-pid="'+t+'" class="xActive"><a href="javascript:;">'+s+"</a></li>");o.data("data",n).data("itemData",{}),i.$.header.append(o),o.click()}a&&a(n)})},setValue:function(t){function a(t){i._createTab(t,function(t){return t.length?void t.forEach(function(t){if(t.title==e[n]){var s=i.$.header.find("li:last");s.data("itemData",t).find(">a").text(t.title),n++,a(t.id)}}):(i.$.header.find("li:first").click(),!1)})}var i=this,e=t.split(this.options.returnJoinChar),n=0;i.$.header.empty(),a(0)},getSelectData:function(){var t=this.$.header.find("li"),a={id:[],pid:[],title:[],data:[]};return t.each(function(t,i){var e=$(i),n=e.data("itemData");$.isEmptyObject(n)||(a.data.push(n),a.id.push(n.id),a.pid.push(n.pid),a.title.push(n.title))}),a},show:function(t){var a=this,i=this.options;return"block"==this.$.node.css("display")?!1:i.onShow.apply(this)===!1?!1:(this.$.node.unbind(a._animateEvent).one(a._animateEvent,function(){a.$.node.removeClass(i.showClassName),t&&t(),i.onShowEnd.apply(a)}),void this.$.node.css({left:this.$.fn.position().left,top:this.$.fn.position().top+i.offset+(this.$.fn.outerHeight?this.$.fn.outerHeight():this.$.fn.height())}).removeClass(i.hideClassName).addClass(i.showClassName).show())},hide:function(t){var a=this,i=this.options;return i.onHide.apply(this)===!1?!1:(this.$.node.one(a._animateEvent,function(){a.$.node.removeClass(i.hideClassName),a.$.node.hide(),t&&t(),i.onHideEnd.apply(a)}),void this.$.node.removeClass(i.showClassName).addClass(i.hideClassName))},destroy:function(){var t=this;return this.options.onDestroy.apply(this)===!1?!1:void this.hide(function(){t.$.node.remove(),t=null})}},$.fn.xLinkSelect2=function(t){var a=$(this);return 0==a.length?a:a.length>1?(a.each(function(){$(this).xLinkSelect2(t)}),a):new xLinkSelect2(a,t)}}(window.jQuery||window.Zepto);